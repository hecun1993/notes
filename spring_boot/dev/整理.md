

## 自定义Bean校验注解

MyConstraint.java

```java
/**
 * 自定义校验注解
 */
@Target({ElementType.METHOD, ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = MyConstraintValidator.class) //表示当前的注解是一个校验的注解
public @interface MyConstraint {

    //如果校验没通过时,展示给用户的信息
    String message() default "my validator";

    Class<?>[] groups() default {};

    Class<? extends Payload>[] payload() default {};
}
```

MyConstraintValidator.java

```java
/**
 * 自定义验证注解的背后支持类, 两个泛型分别的意思是,第一个是自定义验证注解, 第二个是验证的字段的数据类型, 可以写成Object
 */
//不用写@Component, spring会自动放入容器中
public class MyConstraintValidator implements ConstraintValidator<MyConstraint, Object> {

    //在这个校验器中,可以使用依赖注入任何Spring容器中的类,来执行校验逻辑

    //初始化
    @Override
    public void initialize(MyConstraint myConstraint) {
        System.out.println("自定义校验器初始化了...");
    }

    //校验时调用isValid方法,把被加上这个自定义注解的属性(username)的值传入这个方法的第一个参数, 然后对这个值进行校验, 最后返回true或者false
    @Override
    public boolean isValid(Object o, ConstraintValidatorContext constraintValidatorContext) {

        System.out.println("被自定义注解校验的属性的值是" + o.toString());

        //true表示校验通过, 这里写成false是为了打印出@MyConstraint(message = "自定义的校验注解")的message信息
        return false;
    }
}
```



## AOP在spring boot中的使用

```java
/**
 * aop的配置
 *
 * Created by hecun on 2017/9/28.
 */
@Aspect
@Component
//上面的两个注解就已经搞定了切片(类)
public class TimeAspect {
    //总共需要配置两项:
    //1.什么时候起作用(切入点)
//    @Before(): 控制器调用之前执行
//    @After(): 控制器调用之后执行
//    @AfterThrowing: 控制器调用抛出异常时执行
//    @Around(): 完全覆盖了前面三个, 一般都用Around

    //2.在哪些方法上起作用(增强), 用表达式
    @Around("execution(* me.hds.web.controller.UserController.*(..))")
    public Object handlerControllerMethod(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        System.out.println("time aspect start");

        //aop的优势在于可以拿到控制器方法的参数
        Object[] args = proceedingJoinPoint.getArgs();
        System.out.println("aop拿到的调用方法的参数是: " + Arrays.asList(args));

        long start = new Date().getTime();

        //执行被拦截的控制器中的方法
        //控制器方法返回值是什么, proceed就是什么
        Object proceed = proceedingJoinPoint.proceed();

        System.out.println("aop耗时:" + (new Date().getTime() - start));

        System.out.println("time aspect end");

        return proceed;
    }
}
```

